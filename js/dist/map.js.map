{"version":3,"sources":["../src/map.js"],"names":["define","u","sensorPos","inst","ATLAS_PATH","PLANT_PATH","BG_PATH","AJAX_URL","REFRESH_TIME","g","renderer","stage","main","textures","sensorsList","sensors","a","Object","keys","forEach","k","i","initialAjaxLoaded","assetsLoaded","ajax","data","d","num_rows","timestamp_start","timestamp_end","table_name","join","$","url","type","dataType","beforeSend","done","fail","makeDraggable","el","start","e","arr","stopPropagation","alpha","dragging","dragPoint","getLocalPosition","parent","x","position","y","children","length","splice","indexOf","push","move","newPosition","end","add","interactive","on","animate","requestAnimationFrame","render","mousewheel","console","log","deltaY","zoom","pageX","pageY","addEvt","window","resize","innerWidth","innerHeight","zoomIn","direction","factor","local_pt","PIXI","Point","point","interaction","InteractionData","prototype","scale","pivot","tile","extras","TilingSprite","fromImage","width","resolution","height","addChild","s","Sprite","set","createPlant","c","Container","plant","getLongestText","maxNameLen","maxValLen","len","sensor","nameLen","name","valueLen","value","createSensors","ts1","ts2","Text","Graphics","TXT_SCALE","BOX_COLOR","SCALE_X","SCALE_Y","SPACE_BETWEEN_BOXES","fontFamily","fontSize","fill","stroke","b","r1","r2","t1","t2","beginFill","drawRect","endFill","box","nameRectEl","valueTxtEl","valueRectEl","updateSensors","itm","idx","sensorId","destroy","setText","loadData","rowList","setTimeout","makeInitAjax","list","o","sensorName","init","div","fn","jQuery","isStr","document","body","renReso","N","utils","skipHello","autoDetectRenderer","backgroundColor","antialias","transparent","append","view","hitArea","Rectangle","loader","load","resources","texture","isFn","map"],"mappings":"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","file":"map.js","sourcesContent":["define([\"util\", \"positions\"], function (u, sensorPos) {\r\n\tlet inst = {};\r\n\t\r\n\tconst ATLAS_PATH = \"images/atlas.json\";\r\n\tconst PLANT_PATH = \"images/plant.png\";\r\n\tconst BG_PATH = \"images/bg.png\";\r\n\tconst AJAX_URL = \"http://127.0.0.1:1081/khp/report\";\r\n\tconst REFRESH_TIME = 1000;\r\n\t\r\n\t// Scope Globals:\r\n\tlet g = {\r\n\t\trenderer: {},\r\n\t\tstage: {},\r\n\t\tmain: {},\r\n\t\ttextures: {},\r\n\t\tsensorsList: false,\r\n\t\tsensors: {},\r\n\t\tsensorsList: (function(){let a=[];Object.keys(sensorPos).forEach((k,i)=>{a[i]=k;});}()),\r\n\t\tinitialAjaxLoaded: false,\r\n\t\tassetsLoaded: false\r\n\t};\r\n\t\r\n\tfunction ajax(data) {\r\n\t\tvar d = {};\r\n\t\t\r\n\t\td.num_rows        = 1;\r\n\t\td.timestamp_start = 1487968298000;\r\n\t\td.timestamp_end   = 1488056858000;\r\n\t\td.table_name      = \"csv_report\";\r\n\t\td.sensors = data.sensorsList ? data.sensorsList.join(\",\") : g.sensorsList.join(\",\")\r\n\t\t\r\n\t\t$.ajax({\r\n\t\t\turl: AJAX_URL,\r\n\t\t\ttype: \"GET\",\r\n\t\t\tdataType: \"json\",\r\n\t\t\tdata: d,\r\n\t\t\tbeforeSend: data.beforeSend\r\n\t\t})\r\n\t\t.done( data.done )\r\n\t\t.fail( data.fail );\r\n\t}\r\n\t\r\n\tvar makeDraggable = (function (el) {\r\n\t\tfunction start(e) {\r\n\t\t\tvar arr;\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis.data = e.data;\r\n\t\t\tthis.alpha = 0.5;\r\n\t\t\tthis.dragging = true;\r\n\t\t\tthis.dragPoint = e.data.getLocalPosition(this.parent);\r\n\t\t\tthis.dragPoint.x -= this.position.x;\r\n\t\t\tthis.dragPoint.y -= this.position.y;\r\n\t\t\t\r\n\t\t\tarr = this.parent.children;\r\n\t\t\tif (arr.length) {\r\n\t\t\t\tarr.splice( arr.indexOf(this), 1 );\r\n\t\t\t\tarr.push(this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction move(e) {\r\n\t\t\tif (this.dragging) {\r\n\t\t\t\tvar newPosition = this.data.getLocalPosition(this.parent);\r\n\t\t\t\tthis.position.x = newPosition.x - this.dragPoint.x;\r\n\t\t\t\tthis.position.y = newPosition.y - this.dragPoint.y;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction end() {\r\n\t\t\tthis.alpha = 1;\r\n\t\t\tthis.dragging = false;\r\n\t\t\tthis.data = null;\r\n\t\t}\r\n\t\tfunction add(el) {\r\n\t\t\tel.interactive = true;\r\n\t\t\tel\r\n\t\t\t\t.on(\"mousedown\", start)\r\n\t\t\t\t.on(\"touchstart\", start)\r\n\t\t\t\t.on(\"mouseup\", end)\r\n\t\t\t\t.on(\"mouseupoutside\", end)\r\n\t\t\t\t.on(\"touchend\", end)\r\n\t\t\t\t.on(\"touchendoutside\", end)\r\n\t\t\t\t.on(\"mousemove\", move)\r\n\t\t\t\t.on(\"touchmove\", move);\r\n\t\t}\r\n\t\treturn add;\r\n\t}());\r\n\tfunction animate() {\r\n\t\trequestAnimationFrame(animate);\r\n\t\tg.renderer.render(g.stage);\r\n\t}\r\n\tfunction mousewheel(e) {\r\n\t\tconsole.log(e.deltaY);\r\n\t\tzoom(e.pageX, e.pageY, e.deltaY > 0);\r\n\t}\r\n\tfunction addEvt() {\r\n\t\t$(\"canvas\").on(\"mousewheel\", mousewheel);\r\n\t\t$(window).on(\"resize\", function () {\r\n\t\t\tg.renderer.resize(window.innerWidth, window.innerHeight);\r\n\t\t});\r\n\t}\r\n\tfunction zoom(x, y, zoomIn) {\r\n\t\tvar direction = (zoomIn) ? 1 : -1,\r\n\t\t\tfactor = (1 + direction * 0.1),\r\n\t\t\tlocal_pt = new PIXI.Point(),\r\n\t\t\tpoint = new PIXI.Point(x, y),\r\n\t\t\tel = g.stage;\r\n\t\t\r\n\t\tPIXI.interaction.InteractionData.prototype.getLocalPosition(el, local_pt, point);\r\n\t\t\r\n\t\tel.scale.x *= factor;\r\n\t\tel.scale.y *= factor;\r\n\t\tel.pivot = local_pt;\r\n\t\tel.position = point;\r\n\t}\r\n\tfunction start() {\r\n\t\tvar tile = new PIXI.extras.TilingSprite.fromImage(BG_PATH, g.renderer.width / g.renderer.resolution * 1000000, g.renderer.height / g.renderer.resolution *1000000);\r\n\t\ttile.position.x = -1000000;\r\n\t\ttile.position.y = -1000000;\r\n\t\tg.main.addChild(tile);\r\n\t\t\r\n\t\t// var s = new PIXI.Sprite.fromImage( \"images/1.png\");\r\n\t\tvar i;\r\n\t\tvar s;\r\n\t\tvar x = 0;\r\n\t\tvar y = 0;\r\n\t\tfor (i=0; i<9; i+=1) {\r\n\t\t\ts = new PIXI.Sprite( g.textures[i+\".png\"] );\r\n\t\t\ts.scale.set(0.5);\r\n\t\t\ts.x = x;\r\n\t\t\ts.y = y;\r\n\t\t\tx+=50;\r\n\t\t\ty+=50;\r\n\t\t\tmakeDraggable(s);\r\n\t\t\tg.main.addChild(s);\r\n\t\t}\r\n\t}\r\n\tfunction createPlant() {\r\n\t\tvar c, s;\r\n\t\t\r\n\t\tc = new PIXI.Container();\r\n\t\ts = new PIXI.Sprite( g.textures.plant );\r\n\t\ts.scale.set(0.5);\r\n\t\tc.addChild(s);\r\n\t\t\r\n\t\tg.main.addChild(c);\r\n\t\tg.stage.position.set(500, 50);\r\n\t}\r\n\tfunction getLongestText(sensors) {\r\n\t\tlet maxNameLen = 0,\r\n\t\t\tmaxValLen = 0,\r\n\t\t\tkeys = Object.keys(sensors);\r\n\t\t\r\n\t\tfor (let i=0, len=keys.length; i<len; i+=1) {\r\n\t\t\tlet sensor = sensors[ keys[i] ],\r\n\t\t\t\tnameLen = sensor.name.length,\r\n\t\t\t\tvalueLen = sensor.value.length;\r\n\t\t\t\r\n\t\t\tif (nameLen > maxNameLen) {\r\n\t\t\t\tmaxNameLen = nameLen;\r\n\t\t\t}\r\n\t\t\tif (valueLen > maxValLen) {\r\n\t\t\t\tmaxValLen = valueLen;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t}\r\n\tfunction createSensors(sensors) {\r\n\t\tvar ts1, ts2,\r\n\t\t\tText = PIXI.Text,\r\n\t\t\tGraphics = PIXI.Graphics,\r\n\t\t\tTXT_SCALE = 0.2,\r\n\t\t\tBOX_COLOR = 0x02C4C4,\r\n\t\t\tSCALE_X = 1.2,\r\n\t\t\tSCALE_Y = 1.4,\r\n\t\t\tSPACE_BETWEEN_BOXES = 8;\r\n\t\t\r\n\t\tts1 = {\r\n\t\t\tfontFamily: 'Arial',\r\n\t\t\tfontSize: '100px',\r\n\t\t\tfill: '#002200',\r\n\t\t\tstroke: '#4a1850'\r\n\t\t};\r\n\t\tts2 = {\r\n\t\t\tfontFamily: 'Arial',\r\n\t\t\tfontSize: '100px',\r\n\t\t\tfill: '#F7EDCA',\r\n\t\t\tstroke: '#4a1850'\r\n\t\t};\r\n\t\t\r\n\t\tObject.keys(sensors).forEach(function (k) {\r\n\t\t\tvar sensor = sensors[k],\r\n\t\t\t\tb = new PIXI.Container(),\r\n\t\t\t\tr1, r2,\r\n\t\t\t\tt1, t2;\r\n\t\t\t\r\n\t\t\tt1 = new Text(\"\"+sensor.name, ts1);\r\n\t\t\tt1.scale.set( TXT_SCALE );\r\n\t\t\t\r\n\t\t\tt2 = new Text(\"\"+sensor.value, ts2);\r\n\t\t\tt2.scale.set( TXT_SCALE );\r\n\t\t\t\r\n\t\t\tr1 = new Graphics();\r\n\t\t\tr1.beginFill( BOX_COLOR );\r\n\t\t\tr1.drawRect(0, 0, t1.width * SCALE_X, t1.height * SCALE_Y);\r\n\t\t\tr1.endFill();\r\n\t\t\t\r\n\t\t\tr2 = new Graphics();\r\n\t\t\tr2.beginFill( BOX_COLOR );\r\n\t\t\tr2.drawRect(0, 0, t2.width * SCALE_X*1.3, t2.height * SCALE_Y);\r\n\t\t\tr2.endFill();\r\n\t\t\tr2.position.x = r1.x + r1.width + SPACE_BETWEEN_BOXES;\r\n\t\t\t\r\n\t\t\tt1.position.x += (r1.width - t1.width) /2;\r\n\t\t\tt1.position.y += (r1.height - t1.height) /2;\r\n\t\t\tt2.position.x = r2.x + (r2.width - t2.width) /2;\r\n\t\t\tt2.position.y = r2.y + (r2.height - t2.height) /2;\r\n\t\t\t\r\n\t\t\tb.position.set(sensor.x, sensor.y);\r\n\t\t\t\r\n\t\t\tb.addChild(r1);\r\n\t\t\tb.addChild(r2);\r\n\t\t\tb.addChild(t1);\r\n\t\t\tb.addChild(t2);\r\n\t\t\t\r\n\t\t\t\r\n\t\t\tg.main.addChild(b);\r\n\t\t\t\r\n\t\t\tg.sensors[k] = {\r\n\t\t\t\tbox: b,\r\n\t\t\t\tnameRectEl: r1,\r\n\t\t\t\tvalueTxtEl: t2,\r\n\t\t\t\tvalueRectEl: r2\r\n\t\t\t};\r\n\t\t});\r\n\t\t\r\n\t\t\r\n\t}\r\n\tfunction updateSensors(arr) {\r\n\t\tarr.forEach(function (itm, idx) {\r\n\t\t\tvar sensor = g.sensors[ itm.sensorId ],\r\n\t\t\t\tr1, t2, r2;\r\n\t\t\t\r\n\t\t\tr2 = sensor.valueRectEl;\r\n\t\t\tr1 = sensor.nameRectEl;\r\n\t\t\tt2 = sensor.valueTxtEl;\r\n\t\t\t\r\n\t\t\tr2.destroy(true);\r\n\t\t\t\r\n\t\t\tt2.setText(\"\"+itm.value);\r\n\t\t\t\r\n\t\t\tr2 = new PIXI.Graphics();\r\n\t\t\tr2.beginFill( 0x02C4C4 );\r\n\t\t\tr2.drawRect(0, 0, t2.width * 1.5, t2.height * 1.4);\r\n\t\t\tr2.endFill();\r\n\t\t\tr2.position.x = r1.x + r1.width + 8;\r\n\t\t\tsensor.box.addChild(r2);\r\n\t\t\t\r\n\t\t\tvar arr = t2.parent.children;\r\n\t\t\tarr.splice( arr.indexOf(t2), 1 );\r\n\t\t\tarr.push(t2);\r\n\t\t\t\r\n\t\t\tsensor.valueRectEl = r2;\r\n\t\t});\r\n\t}\r\n\tfunction loadData() {\r\n\t\tajax({\r\n\t\t\tdone: function (data) {\r\n\t\t\t\t\r\n\t\t\t\tupdateSensors( data.rowList );\r\n\t\t\t\t\r\n\t\t\t\tsetTimeout(loadData, REFRESH_TIME);\r\n\t\t\t},\r\n\t\t\tfail: function () {\r\n\t\t\t\tsetTimeout(loadData, 1000);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tfunction makeInitAjax() {\r\n\t\tvar list, o;\r\n\t\t\r\n\t\tif ( g.assetsLoaded ) {\r\n\t\t\tlist = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];\r\n\t\t\to = {};\r\n\t\t\tg.sensorsList = list;\r\n\t\t\t\r\n\t\t\to.sensorsList = list;\r\n\t\t\to.done = function (data) {\r\n\t\t\t\tvar arr;\r\n\t\t\t\t\r\n\t\t\t\tg.initialAjaxLoaded = true;\r\n\t\t\t\t\r\n\t\t\t\tarr = data.rowList;\r\n\t\t\t\tarr.forEach(function (itm) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar sensor = sensorPos[itm.sensorId];\r\n\t\t\t\t\t\r\n\t\t\t\t\tsensor.name = itm.sensorName + \" :\";\r\n\t\t\t\t\tsensor.value = \"\"+itm.value;\r\n\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tcreateSensors(sensorPos);\r\n\t\t\t\t\r\n\t\t\t\tsetTimeout(loadData, REFRESH_TIME);\r\n\t\t\t};\r\n\t\t\to.fail = function (data) {\r\n\t\t\t\tsetTimeout(makeInitAjax, 1000);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tajax(o);\r\n\t\t\r\n\t\t} else {\r\n\t\t\tsetTimeout(makeInitAjax, 1000);\r\n\t\t}\r\n\t}\r\n\tfunction init(div, fn) {\r\n\t\tmakeInitAjax();\r\n\t\t\r\n\t\tdiv = div instanceof jQuery ? div : u.isStr(div) ? $(div) : $(document.body);\r\n\t\tvar stage, main, renderer,\r\n\t\t\trenReso,\r\n\t\t\tN = 100000;\r\n\t\t\r\n\t\tPIXI.utils.skipHello();\r\n\t\tg.renderer = PIXI.autoDetectRenderer(\r\n\t\t\twindow.innerWidth,\r\n\t\t\twindow.innerHeight,\r\n\t\t\t{\r\n\t\t\t\tbackgroundColor: 0x4e342e ,// 0xf5eed8, // 0xAB9988, // 0xAB9999,\r\n\t\t\t\tantialias: false,\r\n\t\t\t\ttransparent: false\r\n\t\t\t}\r\n\t\t);\r\n\t\tg.stage = new PIXI.Container();\r\n\t\tg.main = new PIXI.Container();\r\n\t\t\r\n\t\trenderer = g.renderer;\r\n\t\tstage = g.stage;\r\n\t\tmain = g.main;\r\n\t\trenReso = renderer.resolution;\r\n\t\t\r\n\t\tdiv.append( renderer.view );\r\n\t\t\r\n\t\tmain.hitArea = new PIXI.Rectangle( -1000000, -1000000, renderer.width / renReso * 1000000, renderer.height / renReso *1000000 );\r\n\t//\tstage.interactive = true;\r\n\t\tmakeDraggable(main);\r\n\t\taddEvt();\r\n\t\tstage.addChild( main );\r\n\t\t\r\n\t\t// PIXI.SCALE_MODES.DEFAULT = PIXI.SCALE_MODES.NEAREST;\r\n\t\tPIXI.loader.add( PLANT_PATH );\r\n\t\tPIXI.loader.add( ATLAS_PATH );\r\n\t\tPIXI.loader.load(function () {\r\n\t\t\tg.assetsLoaded = true;\r\n\t\t\tg.textures = PIXI.loader.resources[ATLAS_PATH].textures;\r\n\t\t\tg.textures[\"plant\"] = PIXI.loader.resources[PLANT_PATH].texture;\r\n\t\t\tif ( u.isFn(fn) ) {\r\n\t\t\t\tfn();\r\n\t\t\t}\r\n\t\t//\tstart();\r\n\t\t\tcreatePlant();\r\n\t\t});\r\n\t\trequestAnimationFrame( animate );\r\n\t\trenderer.render( stage );\r\n\t\t\r\n\t\t\r\n\t}\r\n\t\r\n\tinst.init = init;\r\n\tinst.g = g;\r\n\twindow.map = inst;\r\n\t\r\n\treturn inst;\r\n});\r\n\r\n/* $.support.cors = true;\r\n\r\n\t$.ajaxSetup({\r\n\t\tcrossDomain: true\r\n\t}); */"]}