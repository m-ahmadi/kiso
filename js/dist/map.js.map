{"version":3,"sources":["../src/map.js"],"names":["define","u","sensorPos","inst","ATLAS_PATH","PLANT_PATH","BG_PATH","HOST","determineHost","AJAX_URL","REFRESH_TIME","FAIL_RETRY_TIME","NO_ASSETS_RETRY_TIME","TXT_SCALE","BOX_COLOR","SCALE_X","SCALE_Y","SPACE_BETWEEN_BOXES","g","renderer","stage","main","textures","sensors","sensorsList","a","Object","keys","forEach","k","i","initialAjaxLoaded","assetsLoaded","host","window","location","res","ajax","data","d","num_rows","timestamp_start","timestamp_end","table_name","join","$","url","type","dataType","beforeSend","done","fail","makeDraggable","el","start","e","stopPropagation","alpha","dragging","dragPoint","getLocalPosition","parent","x","position","y","arr","children","length","splice","indexOf","push","move","newPosition","end","add","interactive","on","animate","requestAnimationFrame","render","mousewheel","zoom","pageX","pageY","deltaY","addEvt","resize","innerWidth","innerHeight","zoomIn","direction","factor","local_pt","PIXI","Point","point","interaction","InteractionData","prototype","scale","pivot","tile","extras","TilingSprite","fromImage","width","resolution","height","addChild","s","Sprite","set","createPlant","c","Container","plant","getLongestText","nameMax","valueMax","name","value","len","sensor","nameLen","valueLen","createSensor","largestName","largestVal","wR1","wR2","Text","Graphics","ts1","fontFamily","fontSize","fontWeight","fill","stroke","ts2","b","t1","t2","r1","beginFill","drawRect","endFill","r2","box","nameRectEl","valueTxtEl","valueRectEl","undefined","createSensors","longest","lngName","lngVal","nW","vW","updateSensors","itm","idx","sensorId","setText","loadData","rowList","setTimeout","makeInitAjax","list","o","sensorName","init","fn","loader","div","jQuery","isStr","document","body","utils","skipHello","autoDetectRenderer","backgroundColor","antialias","transparent","renReso","append","view","hitArea","Rectangle","load","resources","texture","isFn","map"],"mappings":"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","file":"map.js","sourcesContent":["define([\"util\", \"positions\"], function (u, sensorPos) {\r\n\tlet inst = {};\r\n\t\r\n\tconst ATLAS_PATH = \"images/atlas.json\";\r\n\tconst PLANT_PATH = \"images/plant.png\";\r\n\tconst BG_PATH = \"images/bg.png\";\r\n\tconst HOST = determineHost();\r\n\tconst AJAX_URL = `http://${HOST}/khp/report`; // \"http://127.0.0.1:1081/khp/report\"\r\n\tconst REFRESH_TIME = 60000;\r\n\tconst FAIL_RETRY_TIME = 200;\r\n\tconst NO_ASSETS_RETRY_TIME = 100;\r\n\t\r\n\tconst TXT_SCALE = 0.2;\r\n\tconst BOX_COLOR = 0x02C4C4;\r\n\tconst SCALE_X = 1.2;\r\n\tconst SCALE_Y = 1.4;\r\n\tconst SPACE_BETWEEN_BOXES = 8;\r\n\t\r\n\t// Scope globals prefixed with g. for better readablity:\r\n\tlet g = {\r\n\t\trenderer: {},\r\n\t\tstage: {},\r\n\t\tmain: {},\r\n\t\ttextures: {},\r\n\t\tsensors: {},\r\n\t\tsensorsList: (function(){let a=[];Object.keys(sensorPos).forEach((k,i)=>{a[i]=k;});}()),\r\n\t\tinitialAjaxLoaded: false,\r\n\t\tassetsLoaded: false\r\n\t};\r\n\t\r\n\tfunction determineHost() {\r\n\t\tlet host = window.location.host;\r\n\t\tlet res;\r\n\t\tif (host) {\t\r\n\t\t\tif (host === \"localhost\" || host === \"127.0.0.1\") {\r\n\t\t\t\tres = `${host}:1081`;\r\n\t\t\t} else if (host === \"80.85.82.83\" || host === \"10.10.200.64\") {\r\n\t\t\t\tres = `${host}:8081`;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\tfunction ajax(data) {\r\n\t\tlet d = {};\r\n\t\t\r\n\t\td.num_rows        = 1;\r\n\t\td.timestamp_start = 1487968298000;\r\n\t\td.timestamp_end   = 1488056858000;\r\n\t\td.table_name      = \"csv_report\";\r\n\t\td.sensors = data.sensorsList ? data.sensorsList.join(\",\") : g.sensorsList.join(\",\")\r\n\t\t\r\n\t\t$.ajax({\r\n\t\t\turl: AJAX_URL,\r\n\t\t\ttype: \"GET\",\r\n\t\t\tdataType: \"json\",\r\n\t\t\tdata: d,\r\n\t\t\tbeforeSend: data.beforeSend\r\n\t\t})\r\n\t\t.done( data.done )\r\n\t\t.fail( data.fail );\r\n\t}\r\n\tlet makeDraggable = (function (el) {\r\n\t\tfunction start(e) {\r\n\t\t\te.stopPropagation();\r\n\t\t\tthis.data = e.data;\r\n\t\t\tthis.alpha = 0.5;\r\n\t\t\tthis.dragging = true;\r\n\t\t\tthis.dragPoint = e.data.getLocalPosition(this.parent);\r\n\t\t\tthis.dragPoint.x -= this.position.x;\r\n\t\t\tthis.dragPoint.y -= this.position.y;\r\n\t\t\t\r\n\t\t\tlet arr = this.parent.children;\r\n\t\t\tif (arr.length) {\r\n\t\t\t\tarr.splice( arr.indexOf(this), 1 );\r\n\t\t\t\tarr.push(this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction move(e) {\r\n\t\t\tif (this.dragging) {\r\n\t\t\t\tlet newPosition = this.data.getLocalPosition(this.parent);\r\n\t\t\t\tthis.position.x = newPosition.x - this.dragPoint.x;\r\n\t\t\t\tthis.position.y = newPosition.y - this.dragPoint.y;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction end() {\r\n\t\t\tthis.alpha = 1;\r\n\t\t\tthis.dragging = false;\r\n\t\t\tthis.data = null;\r\n\t\t}\r\n\t\tfunction add(el) {\r\n\t\t\tel.interactive = true;\r\n\t\t\tel\r\n\t\t\t\t.on(\"mousedown\", start)\r\n\t\t\t\t.on(\"touchstart\", start)\r\n\t\t\t\t.on(\"mouseup\", end)\r\n\t\t\t\t.on(\"mouseupoutside\", end)\r\n\t\t\t\t.on(\"touchend\", end)\r\n\t\t\t\t.on(\"touchendoutside\", end)\r\n\t\t\t\t.on(\"mousemove\", move)\r\n\t\t\t\t.on(\"touchmove\", move);\r\n\t\t}\r\n\t\treturn add;\r\n\t}());\r\n\tfunction animate() {\r\n\t\trequestAnimationFrame(animate);\r\n\t\tg.renderer.render(g.stage);\r\n\t}\r\n\tfunction mousewheel(e) {\r\n\t\tzoom(e.pageX, e.pageY, e.deltaY > 0);\r\n\t}\r\n\tfunction addEvt() {\r\n\t\t$(\"canvas\").on(\"mousewheel\", mousewheel);\r\n\t\t$(window).on(\"resize\", function () {\r\n\t\t\tg.renderer.resize(window.innerWidth, window.innerHeight);\r\n\t\t});\r\n\t}\r\n\tfunction zoom(x, y, zoomIn) {\r\n\t\tlet direction = (zoomIn) ? 1 : -1,\r\n\t\t\tfactor = (1 + direction * 0.1),\r\n\t\t\tlocal_pt = new PIXI.Point(),\r\n\t\t\tpoint = new PIXI.Point(x, y),\r\n\t\t\tel = g.stage;\r\n\t\t\r\n\t\tPIXI.interaction.InteractionData.prototype.getLocalPosition(el, local_pt, point);\r\n\t\t\r\n\t\tel.scale.x *= factor;\r\n\t\tel.scale.y *= factor;\r\n\t\tel.pivot = local_pt;\r\n\t\tel.position = point;\r\n\t}\r\n\t\r\n\tfunction start() {\r\n\t\tlet tile = new PIXI.extras.TilingSprite.fromImage(BG_PATH, g.renderer.width / g.renderer.resolution * 1000000, g.renderer.height / g.renderer.resolution *1000000);\r\n\t\ttile.position.x = -1000000;\r\n\t\ttile.position.y = -1000000;\r\n\t\tg.main.addChild(tile);\r\n\t\t\r\n\t\t// var s = new PIXI.Sprite.fromImage( \"images/1.png\");\r\n\t\tlet x = 0,\r\n\t\t\ty = 0;\r\n\t\tfor (let i=0; i<9; i+=1) {\r\n\t\t\tlet s = new PIXI.Sprite( g.textures[i+\".png\"] );\r\n\t\t\ts.scale.set(0.5);\r\n\t\t\ts.x = x;\r\n\t\t\ts.y = y;\r\n\t\t\tx+=50;\r\n\t\t\ty+=50;\r\n\t\t\tmakeDraggable(s);\r\n\t\t\tg.main.addChild(s);\r\n\t\t}\r\n\t}\r\n\tfunction createPlant() {\r\n\t\tlet c = new PIXI.Container();\r\n\t\tlet s = new PIXI.Sprite( g.textures.plant );\r\n\t\t\r\n\t\ts.scale.set(0.5);\r\n\t\tc.addChild(s);\r\n\t\t\r\n\t\tg.main.addChild(c);\r\n\t\tg.stage.position.set(500, 50);\r\n\t}\r\n\tfunction getLongestText(sensors) {\r\n\t\tlet nameMax = 0,\r\n\t\t\tvalueMax = 0,\r\n\t\t\tkeys = Object.keys(sensors),\r\n\t\t\tname, value;\r\n\t\t\r\n\t\tfor (let i=0, len=keys.length; i<len; i+=1) {\r\n\t\t\tlet sensor = sensors[ keys[i] ],\r\n\t\t\t\tnameLen = sensor.name.length,\r\n\t\t\t\tvalueLen = sensor.value.length;\r\n\t\t\t\r\n\t\t\tif (nameLen > nameMax) {\r\n\t\t\t\tnameMax = nameLen;\r\n\t\t\t\tname = keys[i];\r\n\t\t\t}\r\n\t\t\tif (valueLen > valueMax) {\r\n\t\t\t\tvalueMax = valueLen;\r\n\t\t\t\tvalue = keys[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn {name, value};\r\n\t}\r\n\tfunction createSensor(sensor, k, largestName, largestVal, wR1, wR2, add) {\r\n\t\tlet\tText = PIXI.Text;\r\n\t\tlet Graphics = PIXI.Graphics;\r\n\t\tlet ts1 = {\r\n\t\t\tfontFamily: 'Arial',\r\n\t\t\tfontSize: '100px',\r\n\t\t\tfontWeight : 'bold',\r\n\t\t\tfill: '#002200', // 002200\r\n\t\t\tstroke: '#4a1850'\r\n\t\t};\r\n\t\tlet ts2 = {\r\n\t\t\tfontFamily: 'Arial',\r\n\t\t\tfontSize: '100px',\r\n\t\t\tfontWeight : 'bold',\r\n\t\t\tfill: '#002200', // F7EDCA\r\n\t\t\tstroke: '#4a1850'\r\n\t\t};\r\n\t\t\r\n\t\tlet b = new PIXI.Container();\r\n\t\t\r\n\t\tlet t1 = new Text(\"\"+sensor.name, ts1);\r\n\t\tt1.scale.set( TXT_SCALE );\r\n\t\t\r\n\t\tlet t2 = new Text(\"\"+sensor.value, ts2);\r\n\t\tt2.scale.set( TXT_SCALE );\r\n\t\t\r\n\t\tlet r1 = new Graphics();\r\n\t\tr1.beginFill( BOX_COLOR );\r\n\t\tr1.drawRect(0, 0, wR1 ? wR1 : t1.width * SCALE_X, t1.height * SCALE_Y);\r\n\t\tr1.endFill();\r\n\t\t\r\n\t\tlet r2 = new Graphics();\r\n\t\tr2.beginFill( BOX_COLOR );\r\n\t\tr2.drawRect(0, 0, wR2 ? wR2 : t2.width * SCALE_X*1.3, t2.height * SCALE_Y);\r\n\t\tr2.endFill();\r\n\t\tr2.position.x = r1.x + r1.width + SPACE_BETWEEN_BOXES;\r\n\t\t\r\n\t\tt1.position.x += (r1.width - t1.width) /2;\r\n\t\tt1.position.y += (r1.height - t1.height) /2;\r\n\t\tt2.position.x = r2.x + (r2.width - t2.width) /2;\r\n\t\tt2.position.y = r2.y + (r2.height - t2.height) /2;\r\n\t\t\r\n\t\tb.position.set(sensor.x, sensor.y);\r\n\t\t\r\n\t\tb.addChild(r1);\r\n\t\tb.addChild(r2);\r\n\t\tb.addChild(t1);\r\n\t\tb.addChild(t2);\r\n\t\t\r\n\t\tif (add) {\r\n\t\t\tg.main.addChild(b);\r\n\t\t\tg.sensors[k] = {\r\n\t\t\t\tbox: b,\r\n\t\t\t\tnameRectEl: r1,\r\n\t\t\t\tvalueTxtEl: t2,\r\n\t\t\t\tvalueRectEl: r2\r\n\t\t\t};\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\treturn largestName ? r1.width :\r\n\t\t\t   largestVal   ? r2.width : undefined;\r\n\t}\r\n\tfunction createSensors(sensors) {\r\n\t\tlet longest = getLongestText(sensors);\r\n\t\tlet lngName = longest.name;\r\n\t\tlet lngVal = longest.value;\r\n\t\t\r\n\t\tlet nW = createSensor(sensors[lngName], lngName, true);\r\n\t\tlet vW = createSensor(sensors[lngVal], lngVal, false, true);\r\n\t\t\r\n\t\t\r\n\t\tObject.keys(sensors).forEach(function (k) {\r\n\t\t\tlet sensor = sensors[k];\r\n\t\t\tif (sensor) {\r\n\t\t\t\tcreateSensor( sensor, k, false, false, nW, vW, true );\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t}\r\n\tfunction updateSensors(arr) {\r\n\t\tarr.forEach(function (itm, idx) {\r\n\t\t\tlet sensor = g.sensors[ itm.sensorId ];\r\n\t\t\tsensor.valueTxtEl.setText(\"\"+itm.value);\r\n\t\t});\r\n\t}\r\n\tfunction loadData() {\r\n\t\tajax({\r\n\t\t\tdone (data) {\r\n\t\t\t\tupdateSensors( data.rowList );\r\n\t\t\t\tsetTimeout(loadData, REFRESH_TIME);\r\n\t\t\t},\r\n\t\t\tfail () {\r\n\t\t\t\tsetTimeout(loadData, 1000);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tfunction makeInitAjax() {\r\n\t\tif ( g.assetsLoaded ) {\r\n\t\t\tlet list = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];\r\n\t\t\tlet o = {};\r\n\t\t\tg.sensorsList = list;\r\n\t\t\t\r\n\t\t\to.sensorsList = list;\r\n\t\t\to.done = function (data) {\r\n\t\t\t\tg.initialAjaxLoaded = true;\r\n\t\t\t\t\r\n\t\t\t\tlet arr = data.rowList;\r\n\t\t\t\tarr.forEach(function (itm) {\r\n\t\t\t\t\tlet sensor = sensorPos[itm.sensorId];\r\n\t\t\t\t\t\r\n\t\t\t\t\tsensor.name = itm.sensorName + \" :\";\r\n\t\t\t\t\tsensor.value = \"\"+itm.value;\r\n\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tcreateSensors(sensorPos);\r\n\t\t\t\t\r\n\t\t\t\tsetTimeout(loadData, REFRESH_TIME);\r\n\t\t\t};\r\n\t\t\to.fail = function (data) {\r\n\t\t\t\tsetTimeout(makeInitAjax, FAIL_RETRY_TIME);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tajax(o);\r\n\t\t\r\n\t\t} else {\r\n\t\t\tsetTimeout(makeInitAjax, NO_ASSETS_RETRY_TIME);\r\n\t\t}\r\n\t}\r\n\tfunction init(el, fn) {\r\n\t\tmakeInitAjax();\r\n\t\tlet Container = PIXI.Container;\r\n\t\tlet loader = PIXI.loader;\r\n\t\tlet div = el instanceof jQuery ? el    :\r\n\t\t\t\t  u.isStr(el)          ? $(el) :\r\n\t\t\t\t  $(document.body);\r\n\t\t\r\n\t\tPIXI.utils.skipHello();\r\n\t\tg.renderer = PIXI.autoDetectRenderer(\r\n\t\t\twindow.innerWidth,\r\n\t\t\twindow.innerHeight,\r\n\t\t\t{\r\n\t\t\t\tbackgroundColor: 0x4e342e, // 0xf5eed8, // 0xAB9988, // 0xAB9999,\r\n\t\t\t\tantialias: false,\r\n\t\t\t\ttransparent: false\r\n\t\t\t}\r\n\t\t);\r\n\t\tg.stage = new Container();\r\n\t\tg.main = new Container();\r\n\t\t\r\n\t\tlet renderer = g.renderer;\r\n\t\tlet stage = g.stage;\r\n\t\tlet main = g.main;\r\n\t\tlet renReso = renderer.resolution;\r\n\t\t\r\n\t\tdiv.append( renderer.view );\r\n\t\t\r\n\t\tmain.hitArea = new PIXI.Rectangle( -1000000, -1000000, renderer.width / renReso * 1000000, renderer.height / renReso *1000000 );\r\n\t//\tstage.interactive = true;\r\n\t\tmakeDraggable(main);\r\n\t\taddEvt();\r\n\t\tstage.addChild( main );\r\n\t\t\r\n\t\t// PIXI.SCALE_MODES.DEFAULT = PIXI.SCALE_MODES.NEAREST;\r\n\t\tloader.add( PLANT_PATH );\r\n\t\tloader.add( ATLAS_PATH );\r\n\t\tloader.load(function () {\r\n\t\t\tg.assetsLoaded = true;\r\n\t\t\tg.textures = loader.resources[ ATLAS_PATH ].textures;\r\n\t\t\tg.textures[\"plant\"] = loader.resources[ PLANT_PATH ].texture;\r\n\t\t\tif ( u.isFn(fn) ) {\r\n\t\t\t\tfn();\r\n\t\t\t}\r\n\t\t//\tstart();\r\n\t\t\tcreatePlant();\r\n\t\t});\r\n\t\trequestAnimationFrame( animate );\r\n\t\trenderer.render( stage );\r\n\t\t\r\n\t\t\r\n\t}\r\n\t\r\n\tinst.init = init;\r\n\tinst.g = g;\r\n\twindow.map = inst;\r\n\t\r\n\treturn inst;\r\n});"]}